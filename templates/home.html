{% extends 'base.html' %}

{% block title %}Home{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row">
        <div class="col-12">
            <h1 class="text-center">{{ translated_text }}</h1>
            <h2 class="text-center mb-4">Total Sum: {{ total_sum }} UZS</h2>

            <div class="d-flex justify-content-center mb-4">
                <button class="btn btn-warning me-2" id="chooseDateBtn">Choose Date</button>

                <div id="datePickerForm" class="card shadow-sm p-3" style="display: none;">
                    <div class="card-body">
                        <form method="get" action="{% url 'home' %}">
                            <div class="mb-3">
                                <label for="startDate" class="form-label">Start Date:</label>
                                <input type="date" id="startDate" name="start_date" class="form-control" required>
                            </div>
                            <div class="mb-3">
                                <label for="endDate" class="form-label">End Date:</label>
                                <input type="date" id="endDate" name="end_date" class="form-control" required>
                            </div>
                            <button type="submit" class="btn btn-primary">Filter</button>
                            <button type="button" id="cancelBtn" class="btn btn-secondary">Cancel</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="dropdown text-center mb-4">
                <button class="btn btn-success dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                    Filter Transactions
                </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                    <li><a class="dropdown-item" href="?filter=all">All</a></li>
                    <li><a class="dropdown-item" href="?filter=today">Today</a></li>
                    <li><a class="dropdown-item" href="?filter=yesterday">Yesterday</a></li>
                    <li><a class="dropdown-item" href="?filter=week">This Week</a></li>
                    <li><a class="dropdown-item" href="?filter=month">This Month</a></li>
                    <li><a class="dropdown-item" href="?filter=year">This Year</a></li>
                </ul>
            </div>

            <h3 class="text-center mb-4">Transactions</h3>

            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Category</th>
                            <th>Amount</th>
                            <th>Payment Method</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for transaction in transactions %}
                            <tr class="{% if transaction.transaction_type == 'income' %}table-success{% elif transaction.transaction_type == 'expense' %}table-danger{% endif %}">
                                <td>{{ transaction.date }}</td>
                                <td>{{ transaction.transaction_type }}</td>
                                <td>{{ transaction.category }}</td>
                                <td>{{ transaction.amount }} UZS</td>
                                <td>
                                    {% if transaction.payment_method == 'cash' %}
                                        Naqt
                                    {% elif transaction.payment_method == 'card' %}
                                        Karta
                                    {% else %}
                                        N/A
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="{% url 'edit_transaction' transaction.pk %}" class="btn btn-warning btn-sm">Edit</a>
                                    <a href="{% url 'transaction_delete' transaction.pk %}" class="btn btn-danger btn-sm">Delete</a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <section class="about-us mt-5 pt-4 pb-4 bg-light">
                <div class="container text-center">
                    <h2>About Us</h2>
                    <p id="aboutUsText" class="text-muted collapsed">We are dedicated to providing the best financial tracking tools to help you manage your transactions efficiently.</p>
                    <button class="btn btn-info mt-3" id="toggleAboutUs">Read More</button>
                </div>
            </section>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var chooseDateBtn = document.getElementById('chooseDateBtn');
    var datePickerForm = document.getElementById('datePickerForm');
    var cancelBtn = document.getElementById('cancelBtn');
    var toggleAboutUs = document.getElementById('toggleAboutUs');
    var aboutUsText = document.getElementById('aboutUsText');

    chooseDateBtn.addEventListener('click', function() {
        datePickerForm.style.display = 'block';
    });

    cancelBtn.addEventListener('click', function() {
        datePickerForm.style.display = 'none';
    });

    toggleAboutUs.addEventListener('click', function() {
        if (aboutUsText.classList.contains('expanded')) {
            aboutUsText.classList.remove('expanded');
            aboutUsText.classList.add('collapsed');
            toggleAboutUs.textContent = 'Read More';
        } else {
            aboutUsText.classList.remove('collapsed');
            aboutUsText.classList.add('expanded');
            toggleAboutUs.textContent = 'Read Less';
        }
    });
});
</script>

<style>
/* Custom styles for Choose Date button */
#chooseDateBtn {
    background-color: #ffc107; /* Yellow */
    color: black;
    border: none;
}

#chooseDateBtn:hover {
    background-color: #e0a800; /* Darker yellow */
}

/* Custom styles for filter options */
.dropdown-menu .dropdown-item {
    padding: 10px;
    color: #007bff; /* Custom color */
}

.dropdown-menu .dropdown-item:hover {
    background-color: #f1f1f1; /* Custom hover color */
}

/* Custom styles for card */
.card {
    border: 1px solid #ced4da;
    border-radius: .25rem;
}

/* Custom styles for transaction rows */
.table-success {
    background-color: #d4edda; /* Light green */
}

.table-danger {
    background-color: #f8d7da; /* Light red */
}

/* About Us Section */
.about-us {
    border-top: 2px solid #dee2e6;
    margin-bottom: 0; /* Ensure no space below section */
}

.about-us h2 {
    font-size: 2rem;
    margin-bottom: 1rem;
}

#aboutUsText.collapsed {
    font-size: 1rem;
    max-height: 3rem;
    overflow: hidden;
    text-overflow: ellipsis;
}

#aboutUsText.expanded {
    font-size: 1.2rem;
}

#toggleAboutUs {
    transition: transform 0.3s ease;
}

#toggleAboutUs:hover {
    transform: scale(1.1);
}

/* Footer styling */
footer {
    width: 100%;
    position: relative;
    bottom: 0;
    border-top: 1px solid #ced4da;
    background-color: #343a40;
    color: #fff;
    padding: 1rem 0;
    margin-top: 2rem; /* Ensure some space above the footer */
}
</style>
{% endblock %}
